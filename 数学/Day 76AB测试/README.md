设计并分析 A/B 测试（A/B Test）并计算**置信区间（Confidence Interval）** 是评估两个版本（A 和 B）之间差异是否具有统计显著性的重要方法。下面是一个完整的流程，包括：

1. **A/B 测试设计**
2. **假设检验**
3. **置信区间计算**
4. **Python 示例代码**

---

## 🧪 1. A/B 测试设计示例

### 场景：
你想测试一个网页的两个版本（A 和 B）的**转化率（conversion rate）**。例如：

- A：旧版按钮（蓝色）
- B：新版按钮（绿色）

### 数据示例：

| 组别 | 样本数（n） | 转化数（converted） | 转化率（p） |
|------|-------------|---------------------|-------------|
| A    | 5000        | 485                 | 9.7%        |
| B    | 5000        | 525                 | 10.5%       |

---

## 📈 2. 假设检验（Hypothesis Testing）

我们进行的是**两比例检验（Two Proportion Z-test）**。

### 假设设定：

- **零假设 H₀**：p_A = p_B（两个版本的转化率没有显著差异）
- **备择假设 H₁**：p_A ≠ p_B（两个版本的转化率存在显著差异）

---

## 🧮 3. 置信区间计算

### 步骤如下：

#### (1) 计算每组的转化率：
$$
p_A = \frac{\text{转化数}_A}{n_A}, \quad p_B = \frac{\text{转化数}_B}{n_B}
$$

#### (2) 合并比例：
$$
p_{\text{pooled}} = \frac{x_A + x_B}{n_A + n_B}
$$

#### (3) 标准误差（SE）：
$$
SE = \sqrt{p_{\text{pooled}}(1 - p_{\text{pooled}}) \left( \frac{1}{n_A} + \frac{1}{n_B} \right)}
$$

#### (4) 置信区间（以 95% 为例）：
$$
(p_B - p_A) \pm z^* \cdot SE
$$
其中，z* = 1.96 对应 95% 置信水平。

---

## 📊 4. Python 实现

```python
import numpy as np
from scipy import stats

# 输入数据
n_A = 5000
x_A = 485
n_B = 5000
x_B = 525

# 转化率
p_A = x_A / n_A
p_B = x_B / n_B

# 合并比例
p_pooled = (x_A + x_B) / (n_A + n_B)

# 标准误差
SE = np.sqrt(p_pooled * (1 - p_pooled) * (1/n_A + 1/n_B))

# 差异
diff = p_B - p_A

# 95% 置信区间
z = stats.norm.ppf(0.975)  # z* = 1.96
ci_lower = diff - z * SE
ci_upper = diff + z * SE

# 输出结果
print(f"转化率 A: {p_A:.4f}")
print(f"转化率 B: {p_B:.4f}")
print(f"转化率差异: {diff:.4f}")
print(f"95% 置信区间: [{ci_lower:.4f}, {ci_upper:.4f}]")

# 判断是否显著
if ci_lower > 0 or ci_upper < 0:
    print("差异显著（置信区间不包含 0）")
else:
    print("差异不显著（置信区间包含 0）")
```

---

## 📋 示例输出：

```
转化率 A: 0.0970
转化率 B: 0.1050
转化率差异: 0.0080
95% 置信区间: [0.0002, 0.0158]
差异显著（置信区间不包含 0）
```

---

## 🧠 5. 分析与结论

- **转化率差异为 0.8%**，B 版本表现更好。
- **95% 置信区间为 [0.02%, 1.58%]**，不包含 0，说明差异具有统计显著性。
- 因此我们可以**拒绝零假设**，认为 B 版本确实比 A 版本效果更好。

---

## 📚 补充说明

| 指标 | 说明 |
|------|------|
| 显著性水平 α | 通常设为 0.05，对应 95% 置信水平 |
| 效应大小 | 差异越大，越容易检测到显著性 |
| 样本量 | 样本越多，置信区间越窄，检测能力越强 |

---

## ✅ 小贴士

- 确保 A/B 测试是**随机**分配用户，避免偏差。
- 如果测试多个版本（如 A/B/C），需要使用**多重比较校正**（如 Bonferroni 校正）。
- 如果数据不是二值变量（如点击次数、停留时间），可以使用 t-test 或非参数检验（如 Mann-Whitney U）。

---