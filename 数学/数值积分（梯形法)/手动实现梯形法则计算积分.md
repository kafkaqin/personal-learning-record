好的！我们来**手动实现梯形法则（Trapezoidal Rule）** 来计算一个函数在某个区间上的定积分。

---

## 📚 一、什么是梯形法则？

梯形法则是数值积分中的一种基本方法，它通过将积分区间划分成若干小区间，并在每个小区间上用**梯形面积**近似函数曲线下的面积，从而估算整个积分。

### 数学公式：

对于函数 $ f(x) $ 在区间 $[a, b]$ 上的积分：
$$
\int_a^b f(x)\,dx \approx \frac{h}{2} \left[ f(x_0) + 2f(x_1) + 2f(x_2) + \cdots + 2f(x_{n-1}) + f(x_n) \right]
$$

其中：
- $ n $：子区间的个数（分割点数为 $ n+1 $）
- $ h = \frac{b - a}{n} $：每个子区间的宽度
- $ x_i = a + i \cdot h $，$ i = 0, 1, ..., n $

---

## 🧮 二、手动实现 Python 版本

我们以函数 $ f(x) = x^2 $ 在区间 $[0, 1]$ 上的积分为例，精确值为：
$$
\int_0^1 x^2 dx = \frac{1}{3}
$$

### ✅ 实现代码如下：

```python
def trapezoidal_rule(f, a, b, n):
    """
    梯形法则计算定积分 ∫_a^b f(x) dx
    
    参数:
    f : 被积函数 (Python 函数)
    a : 积分下限
    b : 积分上限
    n : 子区间数量（分割点数为 n + 1）
    
    返回:
    近似积分值
    """
    h = (b - a) / n
    total = 0.5 * (f(a) + f(b))  # 第一项和最后一项各乘 0.5
    for i in range(1, n):
        x = a + i * h
        total += f(x)
    return total * h


# 测试函数：f(x) = x^2
def f(x):
    return x ** 2


# 设置参数
a = 0       # 积分下限
b = 1       # 积分上限
n = 100     # 分割的子区间数量

# 计算积分
integral = trapezoidal_rule(f, a, b, n)

# 输出结果
print("近似积分值:", integral)
print("误差:", abs(integral - 1/3))
```

---

## 📈 示例输出：

```
近似积分值: 0.3333500000000001
误差: 5.000000000017764e-05
```

可以看到，使用 `n=100` 时误差已经非常小了！

---

## 🧠 三、误差分析

- **梯形法则的误差阶是 $ O(h^2) $**，即随着步长 $ h $ 缩小，误差以 $ h^2 $ 的速度减小。
- 如果你想要更高的精度，可以尝试：
    - 增大 `n`（即缩小 `h`）
    - 使用更高级的方法，如辛普森法则（Simpson's Rule）

---

## 📌 四、总结

| 步骤 | 内容 |
|------|------|
| 定义函数 | `f(x)` |
| 确定积分区间 | `[a, b]` |
| 划分区间 | 分成 `n` 个等距小区间 |
| 应用梯形公式 | 加权求和并乘以步长 `h` |
| 可选 | 与解析解比较误差 |

---
